import { defineEventHandler } from 'h3'
import connectDB from '~/server/utils/mongodb'
import Classroom from '~/server/models/Classroom'
import { requireAdmin } from '~/server/utils/auth'

export default defineEventHandler( async (event) => {
  await requireAdmin(event)
  await connectDB()

  const rows = [
    {
      stage: 'До применения ларингеальной трубки или интубации трахеи',
      adults: 'Непрямой массаж сердца (частота компрессий 100 в минуту)<br>ИВЛ дыхательным мешком в соотношении 30:2',
      children: 'Выполнить ИВЛ 5 вдохов дыхательным мешком, затем ИВЛ дыхательным мешком в соотношении 15:2 в зависимости от количества реанимирующих<br>Непрямой массаж сердца (частота компрессий 100–110 в минуту вне зависимости от возраста)',
      newborns: 'ИВЛ дыхательным мешком в соотношении 3:1<br>Непрямой массаж сердца (частота компрессий 120 в минуту)'
    },
    {
      stage: 'После применения ларингеальной трубки или интубации трахеи',
      adults: 'Непрямой массаж сердца (частота компрессий 100 в минуту) с перерывами только на дефибрилляцию<br>ИВЛ дыхательным мешком или аппаратная ИВЛ независимо от непрямого массажа сердца ДО = 6 мл/кг, ЧД = 10 в минуту, 100 % кислорода, с перерывами только на дефибрилляцию',
      children: 'Непрямой массаж сердца (частота компрессий 100–110 в минуту вне зависимости от возраста) с перерывами только на дефибрилляцию<br>ИВЛ дыхательным мешком или аппаратная ИВЛ независимо от непрямого массажа сердца ДО = 6 мл/кг, ЧД:<br>у новорождённых — 30 в минуту;<br>у детей от 1 до 3 мес — 30–28 в минуту;<br>у детей с 3 до 6 мес — 26–24 в минуту;<br>с 6 до 9 мес — 24–22 в минуту;<br>с 9 до 12 мес — 22–20 в минуту;<br>с 1 года до 3 лет — 20–18 в минуту;<br>с 3 до 6 лет — 18–16 в минуту;<br>с 6 до 8 лет — 16–14 в минуту;<br>от 8 лет и более — 12 в минуту;<br>100 % кислорода, с перерывами только на дефибрилляцию',
      newborns: 'ИВЛ дыхательным мешком с подключением 30–50 % кислорода, ЧД = 30 в минуту, вне зависимости от непрямого массажа сердца'
    }
  ]

  const notes = [
    'Реанимационные мероприятия прекращаются:\n\n- при неэффективности реанимационных мероприятий, направленных на восстановление жизненно важных функций, в течение 30 минут;\n- при отсутствии у новорождённого при рождении сердцебиения по истечении 10 минут от начала реанимационных мероприятий;\n- в полном объёме (искусственной вентиляции лёгких, массажа сердца, введения лекарственных препаратов).',
    'Реанимационные мероприятия проводят в течение 30 минут от последнего зарегистрированного эпизода электрической активности сердца.'
  ]

  const doc = await Classroom.findOneAndUpdate(
    { section: 'cpr' },
    { title: 'Параметры проведения СЛР', data: { rows, notes } },
    { new: true, upsert: true }
  )

  return { success: true, item: doc }
})


