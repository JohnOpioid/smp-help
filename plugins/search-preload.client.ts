/**
 * –ü–ª–∞–≥–∏–Ω –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –∫–µ—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
 */

export default defineNuxtPlugin(async () => {
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  if (!process.client) return

  console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–∞...')

  try {
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º composable –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º –ø–æ–∏—Å–∫–∞
    const { preloadData, getCacheInfo } = useSearchCache()

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ
    const cacheInfo = getCacheInfo()
    
    if (cacheInfo.cachedData && cacheInfo.cachedData.length > 0) {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∞ —É–∂–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã:', cacheInfo.cachedData.length, '—ç–ª–µ–º–µ–Ω—Ç–æ–≤')
      return
    }

    console.log('üì° –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ...')
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    const searchData = await preloadData()
    
    if (searchData && Array.isArray(searchData) && searchData.length > 0) {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã:', searchData.length, '—ç–ª–µ–º–µ–Ω—Ç–æ–≤')
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      if (process.client && window.Capacitor && window.Capacitor.isNativePlatform()) {
        console.log('üì± Android: –î–∞–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∞ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é')
      }
    } else {
      console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞')
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–∞:', error)
  }
})
