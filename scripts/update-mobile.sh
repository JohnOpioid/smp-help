#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/update-mobile.sh your-domain.com

if [ -z "$1" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 your-domain.com"
    echo "–ü—Ä–∏–º–µ—Ä: $0 smp-help.ru"
    exit 1
fi

DOMAIN=$1

echo "üöÄ –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞..."
echo "üåê –î–æ–º–µ–Ω: $DOMAIN"

# –û–±–Ω–æ–≤–ª—è–µ–º capacitor.config.ts
echo "üìù –û–±–Ω–æ–≤–ª—è–µ–º Capacitor –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
sed -i "s/https:\/\/your-production-domain.com/https:\/\/$DOMAIN/g" capacitor.config.ts

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞..."
npm run build:production

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Capacitor
echo "üì± –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Capacitor..."
npm run cap:sync

echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Android Studio: npm run cap:android"
echo "2. –°–æ–±–µ—Ä–∏—Ç–µ APK –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
echo "3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ë–î"
echo ""
echo "üîó –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫: https://$DOMAIN"
echo "üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: mongodb://help-smp-user:***@185.185.68.107:27017/"
